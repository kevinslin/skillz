<!-- Generated by SpecStory, Markdown v2.0.0 -->

<!-- cursor Session 9ccb9925-163e-43b1-bcd0-40a387b69c76 (2025-11-06 05:03Z) -->

# Combine design documents into final version (2025-11-06 05:03Z)

_**User (2025-11-06 05:08Z)**_

compare @DESIGN.md and @DESIGN-codex.md take the best of both and  make a final design in `DESIGN-combined.md`

---

_**Agent (model gpt-5-codex, mode Agent)**_

<think><details><summary>Thought Process</summary>
**Planning combined design document**</details></think>

---

<tool-use data-tool-type="generic" data-tool-name="todo_write">
<details><summary>Tool use: **todo_write** • Todo List</summary>

- [-] Draft merged outline for DESIGN-combined.md combining highlights from DESIGN.md and DESIGN-codex.md
- [ ] Write merged design content into DESIGN-combined.md with final polish

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Outlining combined design document**

I'm mapping out a detailed structure for merging two design documents into one comprehensive Skillz CLI spec. I'll plan sections for overview, objectives, core concepts, configuration with a unified schema, commands, architecture, safety, UX, testing, and more before writing the final content and applying the patch to add the new file.</details></think>

---

<tool-use data-tool-type="write" data-tool-name="apply_patch">
<details>
        <summary>Tool use: **apply_patch** • Apply patch for undefined</summary>
      

```diff
*** Begin Patch
*** Add File: /Users/kevinlin/code/skillz/DESIGN-combined.md
+# Skillz CLI – Combined Design
+
+## Overview
+
+Skillz is a TypeScript-based CLI that discovers Claude agent skills, normalizes their metadata, and synchronizes them into tooling-specific configuration files (e.g., &#96;AGENTS.md&#96;, &#96;.cursorrules&#96;, &#96;AGENTS.md&#96;). The goal is to make any LLM tooling environment aware of a project&#39;s curated skills with repeatable, trustable workflows that respect existing content.
+
+## Objectives
+
+- Deliver a target-agnostic CLI (&#96;skillz&#96;) that keeps Claude agent skills aligned with local documentation across diverse LLM tools.
+- Automate discovery, normalization, synchronization, diffing, and listing of skills while remaining idempotent and safe for repeated execution.
+- Provide predictable UX with dry runs, backups, and validation so teams can adopt Skillz confidently.
+- Maintain extensibility for new skill sources, output targets, and rendering templates.
+
+## Core Concepts
+
+### Claude Skills Primer
+
+- Skills reside in &#96;SKILL.md&#96; files with YAML frontmatter containing at least &#96;name&#96; and &#96;description&#96;.
+- Skills exist in project-local &#96;.claude/skills/&#96; or global &#96;~/.claude/skills/&#96;; additional directories can be opted in.
+- Each skill encourages progressive disclosure: frontmatter for metadata, markdown body for detailed instructions, optional resource references.
+
+### Cross-LLM Compatibility
+
+Skillz emits managed sections or files that match the expectations of popular LLM tools:
+- &#96;AGENTS.md&#96; for Claude Code.
+- &#96;.cursor/rules&#96; and &#96;.cursorrules&#96; for Cursor.
+- &#96;.aider/conventions.md&#96; for Aider.
+- &#96;.github/copilot-instructions.md&#96; for GitHub Copilot.
+- &#96;.windsurfrules&#96; for Windsurf.
+- &#96;.continue/config.json&#96; for Continue.
+- Additional adapters can target arbitrary custom formats.
+
+## Configuration
+
+### Location &amp; Overrides
+
+- Configuration is stored in &#96;.skills.json&#96; at the workspace root by default.
+- The &#96;SKILLZ_CONFIG&#96; environment variable can point to an alternate config file to support monorepos or multi-workspace setups.
+- Repeated runs of &#96;skillz init&#96; merge or augment existing configuration instead of overwriting blindly.
+
+### Schema
+
+The unified schema blends target flexibility, markers, and advanced options:
+
+&#96;&#96;&#96;json
+{
+  &quot;version&quot;: 1,
+  &quot;targets&quot;: [
+    {
+      &quot;type&quot;: &quot;agents-md&quot; | &quot;cursorrules&quot; | &quot;aider&quot; | &quot;custom&quot;,
+      &quot;path&quot;: &quot;docs/AGENTS.md&quot;,
+      &quot;format&quot;: &quot;markdown&quot; | &quot;json&quot;,
+      &quot;markers&quot;: {
+        &quot;start&quot;: &quot;&lt;!-- skillz:start --&gt;&quot;,
+        &quot;end&quot;: &quot;&lt;!-- skillz:end --&gt;&quot;
+      },
+      &quot;template&quot;: &quot;default&quot; // or path to custom Handlebars template
+    }
+  ],
+  &quot;skillSources&quot;: [
+    { &quot;type&quot;: &quot;claude&quot;, &quot;path&quot;: &quot;.claude/skills&quot; },
+    { &quot;type&quot;: &quot;global&quot;, &quot;path&quot;: &quot;~/.claude/skills&quot; },
+    { &quot;type&quot;: &quot;local&quot;, &quot;path&quot;: &quot;custom-skills/**/*.md&quot; }
+  ],
+  &quot;additionalSkills&quot;: [&quot;/opt/company/skills&quot;],
+  &quot;ignore&quot;: [&quot;*.test&quot;, &quot;experimental-*&quot;],
+  &quot;includeInstructions&quot;: true,
+  &quot;autoSync&quot;: false,
+  &quot;backup&quot;: { &quot;enabled&quot;: true, &quot;keep&quot;: 5 },
+  &quot;lastSynced&quot;: &quot;2025-11-05T10:30:00.000Z&quot;,
+  &quot;options&quot;: {
+    &quot;dryRun&quot;: false,
+    &quot;verbose&quot;: false
+  }
+}
+&#96;&#96;&#96;
+
+Key notes:
+- &#96;targets&#96; may contain multiple entries so Skillz can update different tools simultaneously. Custom adapters can define bespoke &#96;markers&#96; or omit them for file formats that do not support embedded sections.
+- &#96;skillSources&#96; entries allow directory globs and future source types (remote registries, git repos). Duplicate skill names are deduplicated with deterministic precedence.
+- &#96;backup.keep&#96; controls retention; &#96;backup.enabled&#96; toggles creation of timestamped copies.
+- &#96;includeInstructions&#96; decides whether to render full markdown body or frontmatter summary only.
+- Additional per-command options (e.g., &#96;--dry-run&#96;) override config defaults at runtime.
+
+## Command Suite
+
+### &#96;skillz init&#96;
+
+Behavior:
+1. Scans the working directory (depth configurable, default 5) for recognizable target files (&#96;AGENTS.md&#96;, &#96;.cursor/rules&#96;, etc.).
+2. Detects project-local and global Claude skill directories; allows &#96;--additional-skills &lt;path&gt;&#96; (repeatable) with glob support.
+3. Prompts the user to confirm or customize detected configuration (target selection, markers, templates, include instructions, backup policy).
+4. Writes or updates &#96;.skills.json&#96; with merged settings and injects managed markers into the target file if missing.
+5. Optionally triggers an initial &#96;sync&#96; unless &#96;--no-sync&#96; is provided.
+
+Options:
+- &#96;--target &lt;file&gt;&#96; / &#96;--target-type &lt;type&gt;&#96; to bypass discovery.
+- &#96;--additional-skills &lt;path&gt;&#96; (repeatable) and &#96;--global-skills&#96; to add sources.
+- &#96;--template &lt;path&gt;&#96; to set a custom Handlebars template.
+- &#96;--include-instructions&#96; / &#96;--exclude-instructions&#96; to set default behavior.
+- &#96;--no-sync&#96; to skip immediate synchronization.
+- &#96;--force&#96; to overwrite conflicting markers after confirmation.
+
+### &#96;skillz sync&#96;
+
+Behavior:
+1. Loads and validates configuration via Zod schemas; exits with actionable errors if invalid.
+2. Aggregates skills from all configured sources, parsing &#96;SKILL.md&#96; frontmatter and markdown body (&#96;gray-matter&#96;).
+3. Deduplicates skills by &#96;name&#96;, preferring nearer sources and reporting conflicts.
+4. Validates each skill (&#96;name&#96;, &#96;description&#96;, optional metadata constraints) and warns about malformed entries.
+5. Renders managed sections using the target adapter and template engine, including timestamps and source provenance headers.
+6. Creates backups when enabled, performs atomic writes, and updates &#96;lastSynced&#96;.
+7. Reports a summary of changes (added/updated/removed skills) and surfaces manual edit warnings if markers were modified.
+
+Options:
+- &#96;--dry-run&#96; to preview changes without writing (prints diff or preview blocks).
+- &#96;--force&#96; to overwrite managed sections even when manual edits are detected.
+- &#96;--no-backup&#96; to skip backup creation for a run.
+- &#96;--verbose&#96; for detailed logs.
+- &#96;--only &lt;skill-name&gt;&#96; (repeatable) to limit synchronization to specific skills.
+
+### &#96;skillz diff&#96;
+
+Behavior:
+1. Runs the same aggregation and rendering pipeline as &#96;sync&#96; without writing.
+2. Compares the generated content with the current targets to categorize skills: NEW, MODIFIED, REMOVED, UP-TO-DATE.
+3. Outputs a unified diff by default, with optional tabular or JSON views.
+4. Returns exit code &#96;0&#96; when no differences, &#96;1&#96; when changes detected (for CI pipelines).
+
+Options:
+- &#96;--format &lt;table|json|markdown&gt;&#96; to control output style.
+- &#96;--verbose&#96; to include inline content diffs per skill.
+- &#96;--only-changes&#96; to suppress up-to-date entries.
+- &#96;--output &lt;file&gt;&#96; to write diff artifacts for automation.
+
+### &#96;skillz list&#96;
+
+Behavior:
+- Aggregates and validates skills, then formats a summary without touching files.
+- Supports filtering to synced-only or unsynced-only skills to highlight drift.
+
+Options:
+- &#96;--format &lt;table|json|markdown&gt;&#96; for presentation.
+- &#96;--synced-only&#96; / &#96;--unsynced-only&#96; filters.
+- &#96;--verbose&#96; to include source paths and hashes.
+
+### &#96;skillz watch&#96;
+
+Behavior:
+- Uses &#96;chokidar&#96; to observe skill directories and throttled debounced syncs.
+- Emits live status updates and respects the same safety checks as manual syncs.
+
+Options:
+- &#96;--interval &lt;ms&gt;&#96; to adjust polling interval (default 1000).
+- &#96;--no-debounce&#96; to apply immediate sync on changes.
+- &#96;--dry-run&#96; to preview repeated syncs without writing.
+
+### &#96;skillz clean&#96;
+
+- Removes managed sections from the configured targets while preserving manual content.
+- Honors backups and can operate as a dry run.
+
+Options:
+- &#96;--dry-run&#96; to preview removal.
+- &#96;--keep-backup&#96; to retain generated backups (otherwise pruned according to policy).
+
+### &#96;skillz validate&#96;
+
+- Validates &#96;.skills.json&#96; against the schema, ensures skill files contain required frontmatter, checks naming conventions, and verifies file accessibility/permissions.
+- Reports warnings for near-limit values (e.g., long descriptions) and errors for violations.
+
+### &#96;skillz config [key] [value]&#96;
+
+- Reads or mutates configuration keys directly with safe merging semantics.
+- Supports adding/removing array entries (&#96;--add&#96;, &#96;--remove&#96;) and toggling booleans.
+- Provides JSON output for scripting when no value is passed.
+
+### &#96;skillz rollback&#96;
+
+- Restores the most recent backup produced by &#96;sync&#96;, enabling rapid recovery from mistakes.
+- Lists available backups when no target is specified.
+
+## Architecture
+
+### Modular Target Adapters
+
+- &#96;TargetAdapter&#96; interface coordinates detection, reading, diffing, and writing for each target type.
+- Implementations include &#96;AgentsMdAdapter&#96;, &#96;CursorRulesAdapter&#96;, &#96;AiderAdapter&#96;, &#96;CopilotAdapter&#96;, and &#96;CustomAdapter&#96; for template-based outputs.
+- Adapters encapsulate marker management, format-specific rendering, and conflict detection.
+
+### Skill Lifecycle Components
+
+- &#96;SkillParser&#96; parses &#96;SKILL.md&#96; files, producing &#96;Skill&#96; objects with metadata, content, hashes, and timestamps.
+- &#96;SkillScanner&#96; discovers directories and caches file metadata for incremental detection.
+- &#96;ChangeDetector&#96; compares stored hashes with newly computed ones to skip unnecessary rewrites and preserve manual edits outside managed sections.
+- &#96;TemplateEngine&#96; (Handlebars) converts skill data into renderable fragments; default templates can be overridden per target.
+
+### Support Utilities
+
+- &#96;ConfigManager&#96; handles loading/saving, migration between schema versions, and environment overrides using &#96;zod&#96; validation.
+- &#96;BackupManager&#96; creates timestamped backups, restores them, lists history, and prunes old copies.
+- &#96;FsHelpers&#96; wrap filesystem operations to ensure atomic writes and permission checks.
+- &#96;Logger&#96; provides leveled logging with quiet/verbose modes and optional JSON output for automation.
+- &#96;DiffEngine&#96; leverages the &#96;diff&#96; package for unified diff generation used by &#96;sync --dry-run&#96; and &#96;diff&#96;.
+
+## Safety &amp; Reliability
+
+- Manual edit detection guards against modifications inside managed sections; users can re-run &#96;init&#96; or use &#96;--force&#96; to reconcile.
+- Atomic writes coupled with backup creation protect against partial updates or crashes.
+- Validation runs before writes to catch malformed skills or configs.
+- Dry-run support across destructive operations builds trust.
+- Rollback command enables quick recovery.
+
+## User Experience &amp; Logging
+
+- Commands exit with non-zero status on validation failures or unexpected errors.
+- Default output is concise; &#96;--verbose&#96; surfaces diagnostic details such as skipped skills, file paths, and hash comparisons.
+- Interactive prompts (via &#96;inquirer&#96;) guide first-time configuration but every option is scriptable for CI or headless usage.
+- Spinners (&#96;ora&#96;) and colored output (&#96;chalk&#96;) improve feedback while remaining optional for non-TTY environments.
+
+## Testing Strategy
+
+- **Unit Tests**: Cover config parsing, skill parsing, adapters, template rendering, change detection, and backup logic (Jest).
+- **Integration Tests**: Exercise command flows end-to-end using temporary directories, including re-runs and conflict scenarios.
+- **Fixture-Based Tests**: Maintain sample skill directories and target files to validate deterministic output.
+- **Snapshot Tests**: Protect rendered markdown, JSON, or table formats from regressions.
+- **CLI Smoke Tests**: Run actual CLI binaries to ensure argument wiring and exit codes behave as expected.
+
+## Distribution
+
+- Publish as an npm package (&#96;npm install -g skillz-cli&#96;).
+- Use &#96;ncc&#96; or &#96;pkg&#96; to generate standalone binaries for macOS (arm64/x64), Linux (arm64/x64), and Windows (x64).
+- Provide Docker images or scripts for reproducible CI environments if needed.
+
+## Security Considerations
+
+- Validate and normalize all file paths to prevent traversal vulnerabilities.
+- Sanitize any shell commands executed by future extensions.
+- Check file permissions before reading/writing and respect read-only files where possible.
+- Resolve symlinks safely to avoid unexpected target modifications.
+- Enforce schema validation on configuration and frontmatter to prevent invalid states.
+
+## Future Enhancements
+
+1. Plugin system for third-party adapters, validators, or renderers.
+2. Remote skill sources (HTTP, git) with caching and authentication support.
+3. Skill marketplace for discovery and installation.
+4. IDE integrations (VS Code, Cursor) for visual management and inline syncs.
+5. CI/CD integrations (GitHub Actions, GitLab CI) for automated synchronization checks.
+6. Skill dependencies and incompatibility metadata for richer orchestration.
+7. Versioning and changelog tracking per skill.
+8. Analytics on skill usage (opt-in) for teams.
+9. Real-time watch enhancements with incremental diff previews.
+
+## Success Metrics
+
+- Reduced time to onboard new teammates to project-specific skills.
+- Consistent managed sections across targets with minimal drift.
+- High adoption from teams using multiple LLM tools.
+- Clear, actionable error messages with low support overhead.
+- Fast performance (&lt;100 ms for typical syncs) even in large repositories.
+- Reliable automation outcomes in CI/CD pipelines.
+
*** End Patch
```

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Updating todo list status**</details></think>

---

<tool-use data-tool-type="generic" data-tool-name="todo_write">
<details><summary>Tool use: **todo_write** • Todo List</summary>

- [x] Draft merged outline for DESIGN-combined.md combining highlights from DESIGN.md and DESIGN-codex.md
- [x] Write merged design content into DESIGN-combined.md with final polish

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Deciding whether to run lints**</details></think>

---

<tool-use data-tool-type="generic" data-tool-name="read_lints">
<details>
          <summary>Tool use: **read_lints** • Read lints for 1 file</summary>
      
Lint paths:

- `/Users/kevinlin/code/skillz/DESIGN-combined.md`

Lint results


**No lint errors found**
</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Preparing final summary message**</details></think>

---

## Summary
- Created `DESIGN-combined.md` synthesizing the strongest concepts from both original design docs, including unified configuration schema, comprehensive command suite, and consolidated architecture guidance.
- Carried over UX, safety, testing, and future roadmap considerations so the merged plan covers operational details and strategic growth paths.

## Next Steps
- Review the combined design for any team-specific requirements or terminology tweaks.
- Once aligned, share the document with stakeholders and proceed toward implementation planning or backlog refinement.

---

